import subprocess, time, keyboard
import sys

cd = 0.25
clicking = False


def toggle_clicking():
    global clicking
    clicking = not clicking
    print("Autoclicker On" if clicking else "Autoclicker Off")


def set_speed():
    global cd
    print("Cooldown? (ms)")
    while True:
        try:

            sys.stdin.flush()
            user_input = input().strip()

            if not user_input:
                print("Invalid. Must be an integer.")
                continue

            new_speed = int(user_input)

            if new_speed <= 0:
                print("Invalid. Must be a positive integer.")
                continue

            cd = new_speed / 1000
            print(f"Speed set to {new_speed}ms ({cd}s)")
            break

        except ValueError:
            print("Invalid. Must be an integer.")
        except KeyboardInterrupt:
            print("\nCancelled speed change.")
            break


keyboard.add_hotkey('f1', toggle_clicking)
keyboard.add_hotkey('pause', set_speed)

print("Press F1 to toggle autoclicker.")
print("Press PAUSE/BREAK to change speed.")
print(f"Current speed: {int(cd * 1000)}ms")

while True:
    if clicking:
        subprocess.Popen(["xdotool", "click", "1"])
    time.sleep(cd)
